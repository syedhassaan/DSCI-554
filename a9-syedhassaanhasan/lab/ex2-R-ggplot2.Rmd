---
title: "R Notebook"
output: rmarkdown::github_document
---


```{r}
#output: html_notebook
#knitr::opts_chunk$set(echo=FALSE)
```

# üèã ex2 R ggplot2

To get started with `ggplot2` you need to install and load the `ggplot2` package:

```{r}
#install.packages("ggplot2")   #install package once
library("ggplot2")  #use installed package
```

ggplot2 comes with several datasets, you can list the datasets in the ggplot2 package with:

```{r}
data(package = 'ggplot2')
```

# Scatterplots

Scatterplots are realized with the point geom.

Read the docs for `geom_point`

```{r}
?geom_point
```

Minimal plot with Data and Mapping set in Defaults layer:

```{r}
ggplot(mpg, aes(x = displ, y = cty)) + #data and mappings
 geom_point() #geometry
```

Minimal with with data and mappings set in Geom layer

```{r}
ggplot() + geom_point(data=mpg, mapping=aes(displ, cty))  #same not using default mappings
```

You can use transparency to deal with overplotting:
```{r}
ggplot() + geom_point(data=mpg, mapping=aes(displ, cty), alpha=0.5)  #same not using default mappings
```

You can use the `geom_count` a variant geom_point() that counts the number of observations at each location, then maps the count to point area. It useful when you have discrete data and overplotting.

Read the docs with `?geom_count`.

```{r}
?geom_count()
```

```{r}
ggplot(mpg, aes(cty, hwy)) +
 geom_count()
```

Another way to deal with overplotting is to use `geom_jitter`. Note that `geom_jitter()` is a shortcut for `geom_point(position = "jitter")`.

Read the docs with `?geom_jitter`

```{r}
?geom_jitter
```


```{r}
p <- ggplot(mpg, aes(cyl, hwy))
p + geom_point()
p + geom_jitter()
```

# Heatmap of 2d bin counts

The `geom_bin_2d` geom divides the plane into rectangles, counts the number of cases in each rectangle, and then (by default) maps the number of cases to the rectangle's fill. This is a useful alternative to geom_point() in the presence of overplotting.

```{r}
d <- ggplot(diamonds, aes(x, y)) + xlim(4, 10) + ylim(4, 10)
d + geom_bin_2d()
```

# Bar chart

Bar charts are realized with the `geom_bar`

Read the docs with `?geom_bar`

```{r}
?geom_bar()
```


```{r}
ggplot(mpg, aes(x = manufacturer)) +
 geom_bar()
```

Note that the geom_bar() `stat` (the statistical transformation) defaults to 'count'.

If you already have the counts you need to set `stat = 'identity'` or use `geom_col` that uses stat identity.

```{r}
df <- data.frame(trt = c("a", "b", "c"), outcome = c(2.3, 1.9, 3.2))

ggplot(df, aes(trt, outcome)) +
  geom_col()

ggplot(df, aes(trt, outcome)) +
  geom_bar(stat = 'identity')
```

# Histogram and frequency polygons

Histograms are realized using `geom_histogram`.
Frequency polygons are realized using `geom_freqpoly`.

Read the docs with `?geom_histogram` and `?geom_freqpoly`

```{r}
?geom_histogram()
```

```{r}
?geom_freqpoly()
```

```{r}
ggplot(mpg, aes(x = hwy)) +
 geom_histogram()
```

```{r}
ggplot(mpg, aes(x = hwy)) +
 geom_histogram(bins = 15)
```

```{r}
ggplot(mpg, aes(x = hwy)) +
  geom_freqpoly()
```

```{r}
ggplot(mpg, aes(x = hwy)) +
 geom_histogram() +
  geom_freqpoly()
```
# Smoothed density estimates

Smoothed density estimates are realized with the `geom_density` geom.

`geom_density` computes and draws kernel density estimate, which is a smoothed version of the histogram. This is a useful alternative to the histogram for continuous data that comes from an underlying smooth distribution.

Read the docs with `?geom_density`

```{r}
?geom_density()
```

```{r}
ggplot(mpg, aes(x = hwy)) +
 geom_density()
```

# Boxplot

Boxplots are realized with the `geom_boxplot` geom.

Read the docs with `?geom_boxplot`

```{r}
?geom_boxplot()
```

```{r}
ggplot(mpg, aes(x = manufacturer, y = hwy)) +
 geom_boxplot(notch=FALSE)  #default is not to use notches
```

# Violin plot

Violin are realized with the `geom_violin` geom.

Read the docs with `?geom_violin`

```{r}
?geom_violin()
```

```{r}
ggplot(mpg, aes(x = manufacturer, y = hwy)) +
 geom_violin()
```

# Line chart

Line chart are realized with the `geom_line` geom.

Read the docs with `?geom_line`

```{r}
?geom_line
```

```{r}
ggplot(economics, aes(date, unemploy))+ geom_line()
```
And here is a simpler example
```{r}
xval <- 1:10
yval <- cumsum(rnorm(10))
data <- data.frame(xval, yval)

data

ggplot(data, aes(x = xval, y = yval)) +
  geom_line()
```
# Trellis plot (faceting)

You can generate trellis plots in ggplot2 using `facet_wrap()` or `facet_grid()`

Read the docs online with `?ggplot2::facet_wrap` and `?ggplot2::facet_grid`

```{r}
?ggplot2::facet_wrap
```

```{r}
?ggplot2::facet_grid
```

```{r}
p <- ggplot(mpg, aes(displ, hwy)) + geom_point()

# Use vars() to supply faceting variables:
p + facet_wrap(vars(class))

# Control the number of rows and columns with nrow and ncol
p + facet_wrap(vars(class), nrow = 4)
```
# Customizations

See [Modify axis, legend, and plot labels](https://ggplot2.tidyverse.org/reference/labs.html)

Note that in the following we map color to categories and ggplot2 creates a legend with a default categorical color scale.

```{r}
head(mtcars)  #print top rows in cars dataframe

# set defaults
p <- ggplot(mpg, aes(x = displ, y = cty, color = manufacturer))
#add transparency 
p <- p + geom_point(alpha=0.5)

#add axes labels and title
p <- p + xlab('displacement') +
 ylab('city (mpg)') +
 ggtitle('mpg dataset')

#plot
p
```

---

# Exercises

## ü§î Exercise 1

Create a scatterplot of the `iris` dataset:

 - map `x` to `Sepal.Length`
 - map `y` to `Sepal.Width`
 - map `color` to `Species`
 - use geom point `alpha` to `0.5`
 - add jitter with the geom `geom_jitter()`
 - set x axis label to 'Sepal length (cm)'
 - set y axis label to 'Sepal width (cm)'
 - set title label to 'Iris dataset'

```{r}
head(iris)
ggplot(iris, aes(x = Sepal.Length, y = Sepal.Width, color=Species)) + #data and mappings
 geom_point(alpha=0.5) +  #geometry 
 geom_jitter() + 
 xlab('Sepal length (cm)') +
 ylab('Sepal width (cm)') +
 ggtitle('Iris dataset')
```


## üòú Exercise 2 

Create a scatterplot of the `iris` dataset:

 - map `x` to `Sepal.Length`
 - map `y` to `Sepal.Width`
 - map `color` to `Species`
 - map `size` to `Petal.Length`
 - set geom point `alpha` to `0.5`
 - set x axis label to 'Sepal length (cm)'
 - set y axis label to 'Sepal width (cm)'
 - set title label to 'Iris dataset'

```{r}
head(iris)
ggplot(iris, aes(x = Sepal.Length, y = Sepal.Width, color=Species, size=Petal.Length)) + #data and mappings
 geom_point(alpha=0.5) +  #geometry 
 xlab('Sepal length (cm)') +
 ylab('Sepal width (cm)') +
 ggtitle('Iris dataset')

```

## üòú Exercise 3

Create a scatterplot of the `SMO-VOR-2015.csv` dataset:

 - map `x` to `ptime`
 - map `y` to `alt`
 - map `color` to `month`
 - set geom point `alpha` to `0.1`
 - set x axis label to 'Penetration time'
 - set y axis label to 'Altitude (feets)'
 - set title label to 'SMO VOR 2015 dataset'
 - add smooth regression line with `p + geom_smooth()` where `p` is your plot

__What happens if `month` is not a factor with ordered levels:__
<!-- you answer here -->
__We will get the default ordering, which will be alphabetic__

```{r}
df = read.csv('data/SMO-VOR-2015.csv')

#convert `ptime` to datetime
df$ptime <- as.POSIXct(df$ptime,"%Y-%m-%d %H:%M:%S", tz = "America/Los_Angeles")

#set `month` as factor with ordered levels
df$month = factor(df$month, levels=c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"))

head(df)

ggplot(df, aes(x = ptime, y = alt, color=month)) + #data and mappings
 geom_point(alpha=0.1) +  #geometry
 xlab('Penetration time') +
 ylab('Altitude (feets)') +
 ggtitle('SMO VOR 2015 dataset')
```

## üòú Exercise 4

Create a scatterplot of the `SMO-VOR-2015.csv` dataset:

 - map `x` to `month`
 - map `y` to `alt`
 - map `color` to `alt`
 - set geom point `alpha` to `0.1`
 - add jitter to geom point
 - set x axis label to ''
 - set y axis label to 'Altitude (feets)'
 - set title label to 'SMO VOR 2015 dataset'
 - set a sequential gradient scale with `p + scale_color_gradient(low = "red", high = "blue")` where `p` is your plot

```{r}
df = read.csv('data/SMO-VOR-2015.csv')

df$month = factor(df$month, levels=c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"))

head(df)

ggplot(df, aes(x = month, y = alt, color=alt)) + #data and mappings
 geom_point(alpha=0.1) +  #geometry
 geom_jitter() + 
 xlab('') +
 ylab('Altitude (feets)') +
 ggtitle('SMO VOR 2015 dataset') + 
 scale_color_gradient(low = "red", high = "blue")

```

## üòú Exercise 5

Create a bar chart of the `SMO-VOR-2015.csv` dataset:

 - map `x` to `month`
 - set x axis label to ''
 - set y axis label to 'Count'
 - set title label to 'SMO VOR 2015 dataset'
 
 Note that you can check the counts by filtering by month in the dataframe table view.

```{r}
df = read.csv('data/SMO-VOR-2015.csv')

df$month = factor(df$month, levels=c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"))

head(df)

ggplot(df, aes(x = month)) +
geom_bar() + 
xlab('') +
ylab('Count') +
  ggtitle('SMO VOR 2015 dataset')
 
```

## üòú Exercise 6

Create a line chart of the `TSLA.csv` dataset:

 - map `x` to `Date`
 - map `y` to `Close`
 - set x axis label to ''
 - set y axis label to 'Stock closure value ($)'
 - set title label to 'Tesla (TSLA) Jan-Jul 2019'
 
```{r}
df = read.csv('data/TSLA.csv')
df$Date <- as.POSIXct(df$Date, "%Y-%m-%d", tz = "America/Los_Angeles")

head(df)

ggplot(df, aes(Date, Close))+ geom_line() + 
 xlab('') +
 ylab('Stock closure value ($)') +
 ggtitle('Tesla (TSLA) Jan-Jul 2019')


```

## ü§î Exercise 7

Create a scatterplot of the `SMO-VOR-2015.csv` dataset with a boxplot superimposed:

Set default mappings:

 - map `x` to `month`
 - map `y` to `alt`
 - set x axis label to ''
 - set y axis label to 'Altitude (feets)'
 - set title label to 'SMO VOR 2015 dataset'
 
Add geom point layer:

 - map `color` to `alt` (must use `aes(color=alt)`)
 - set geom point `alpha` to `0.1`
 - add jitter to geom point
 
Add geom boxplot layer:

 - add geom boxplot layer
 - set geom boxplot `alpha` to `0.3`


```{r}
df = read.csv('data/SMO-VOR-2015.csv')

df$month = factor(df$month, levels=c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"))

head(df)

ggplot(df, aes(x = month, y = alt)) + #data and mappings
 geom_jitter() + 
 xlab('') +
 ylab('Altitude (feets)') +
 ggtitle('SMO VOR 2015 dataset') + 
 geom_point(aes(color=alt), alpha=0.1, position = "jitter") +  #geometry
 geom_boxplot(notch=FALSE, alpha=0.3)
  
  
```


## üòú Exercise 8

Create a histogram of the `SMO-VOR-2015.csv` dataset:

 - map `x` to `alt`
 - set x axis label to 'Altitude (feets)'
 - set y axis label to 'Counts'
 - set title label to 'SMO VOR 2015 dataset'
 - add geom histogram
 - set geom histogram `alpha` to `0.5` so we can see the grid lines

```{r}
df = read.csv('data/SMO-VOR-2015.csv')

ggplot(df, aes(x = alt)) +
 xlab('Altitude (feets)') +
 ylab('Counts') +
 ggtitle('SMO VOR 2015 dataset') + 
 geom_histogram(alpha=0.5)

```


## üòú Exercise 9

Create a trellis plot with histograms of the `SMO-VOR-2015.csv` dataset faceted by month:

 - map `x` to `alt`
 - set x axis label to 'Altitude (feets)'
 - set y axis label to 'Counts'
 - set title label to 'SMO VOR 2015 dataset'
 - add geom histogram
 - set geom histogram `alpha` to `0.5` so we can see the grid lines
 - add faceting with `p + facet_wrap(facets=vars(month))` where `p` is your plot
 
 Note that `p + facet_wrap(facets=vars(month))` is the same as `p + facet_wrap(~month)`

```{r}
df = read.csv('data/SMO-VOR-2015.csv')

df$month = factor(df$month, levels=c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"))

p <- ggplot(df, aes(x = alt)) +
 xlab('Altitude (feets)') +
 ylab('Counts') +
 ggtitle('SMO VOR 2015 dataset') + 
 geom_histogram(bins = 25, alpha=0.5)

p + facet_wrap(facets=vars(month))
```

## üòú Exercise 10

Render and submit your work.

