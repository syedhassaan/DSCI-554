<!DOCTYPE html>
<html>

<head>
	<title>DSCI 554 Lab 7 ex6</title>

	<link rel="stylesheet" href="style.css">
	<link rel="stylesheet" href="../node_modules/highlightjs/styles/github.css">
	<script src="../node_modules/highlightjs/highlight.pack.min.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>

	<script src="../node_modules/d3/dist/d3.min.js"></script>
</head>

<body>
	<h1>ğŸ‹ğŸ½â€â™‚ï¸ EX6: PIE CHART</h1>

	<h2>0 - Arc generator</h2>
	<hr>

	<p>Read <a target="_blank" href="https://github.com/d3/d3-shape/blob/v2.0.0/README.md#arcs">D3 Arcs API</a> then
		then complete the code in the page where marked with ğŸ’.</p>

	<div class="answer">
		<cap>Answer</cap>

		<svg id="arc-test" width="200" height="200"></svg>

		<script>
			var slice = {  //a slice of pie
				innerRadius: 0,
				outerRadius: 100,
				startAngle: 0,
				endAngle: Math.PI / 2
			};

			var arc = d3.arc();  //ğŸ’ explain: create a new arc generator.
			//console.log(arc(slice));   //ğŸ’ explain: passing a slice to be generated by the arc generator

			var svg = d3.select('#arc-test'),
				width = +svg.attr('width'),
				height = +svg.attr('height'),
				radius = Math.min(width, height) / 2,
				g = svg.append('g')
					.attr('transform', 'translate(' + width / 2 + ',' + height / 2 + ')');  //ğŸ’ explain: appending group element to svg
			g.append('path')  //ğŸ’ explain: appending path to svg
				.attr('d', arc(slice))  //ğŸ’ explain: passing slice to the arc generator
				.attr('fill', "red")
				.attr('stroke', "black");
		</script>
	</div>

	<h2>1 - Pie chart example</h2>
	<hr>

	<p>Read <a target="_blank" href="https://github.com/d3/d3/blob/master/API.md#pies">D3 Pies API</a> then complete the
		Answer where indicated by ğŸ’.</p>

	<p class="alert info">ğŸ’¡ Adapted from <a target="_blank" href="https://bl.ocks.org/mbostock/3887235">Mike Bostockâ€™s
			Block 3887235</a></p>

	<div class="answer">
		<cap>Answer</cap>

		<svg id="pie-chart" width="960" height="500"></svg>

		<style>
			.arc text {
				font: 10px sans-serif;
				text-anchor: middle;
			}

			.arc path {
				stroke: #fff;
			}
		</style>

		<script>
			var slice = {  //a slice of pie
				innerRadius: 0,
				outerRadius: 100,
				startAngle: 0,
				endAngle: Math.PI / 2
			};

			var arc = d3.arc();
			console.log(arc(slice)); // ğŸ’ explain: 

			var svg = d3.select('#arc-test'),
				width = +svg.attr('width'),
				height = +svg.attr('height'),
				radius = Math.min(width, height) / 2,
				g = svg.append('g')
					.attr('transform', 'translate(' + width / 2 + ',' + height / 2 + ')');

			var arc = g.append('path')  //ğŸ’ explain: appending path to svg
				.attr('d', arc(slice))  //ğŸ’ explain: passing slice to the arc generator
				.attr('fill', d => "red");

			d3.csv('data.csv', d => {
				d.population = +d.population;
				return d;
			}).then(data => {
				var svg = d3.select('#pie-chart'),
					width = +svg.attr('width'),
					height = +svg.attr('height'),
					radius = Math.min(width, height) / 2,
					g = svg.append('g')
						.attr('transform', 'translate(' + width / 2 + ',' + height / 2 + ')');

				var color = d3.scaleOrdinal(['#98abc5', '#8a89a6', '#7b6888', '#6b486b']);  //ğŸ’ explain:

				var pie = d3.pie()  //ğŸ’ explain: create a new pie generator.
					.value(d => d.population)
					.sort(null)  //ğŸ’ explain: set the sort order comparator.
				// .sort(function(a, b) { return a.age.localeCompare(b.age); })  //ğŸ’ explain: set the sort order comparator.
				.sortValues(d3.descending);  //ğŸ’ explain: set the sort order comparator, descring order

				var path = d3.arc()  //ğŸ’ explain: computing the arches
					.outerRadius(radius)  //ğŸ’ explain: setting outer radius of arc
					.innerRadius(0);  //ğŸ’ explain: setting inner radius of arc

				//ğŸ’ change to a donut chart
			

				var label = d3.arc()  //ğŸ’ explain: create a new arc generator.
					.outerRadius(radius - 40)  //ğŸ’ explain: setting outer radius of arc
					.innerRadius(radius - 40);  //ğŸ’ explain: setting inner radius of arc

				var arc = g.selectAll('.arc')  //ğŸ’ explain: selecing all the arcs
					.data(pie(data))  //ğŸ’ explain: compute the arc angles for the given dataset.
					.enter()
					.append('g')
					.attr('class', 'arc');

				arc.append('path')  //ğŸ’ explain: appending path to svg
					.attr('d', path)  //ğŸ’ explain: setting the attribute of path
					.attr('fill', d => color(d.data.age));  //ğŸ’ explain: 

				arc.append('text')
					.attr('transform', d => 'translate(' + label.centroid(d) + ')')  //ğŸ’ explain: appending text to the pie chart
					.text(d => d.data.age);
			});
		</script>
	</div>
</body>
</html>